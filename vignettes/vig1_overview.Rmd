---
title: "vig1_overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vig1_overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# The problem

- Simulation based inference (Bayesian or other) gives samples from target distribution 
- Example
   - Note includes correlations
- Power from fact that can approximate distribution of $f(\theta)$ by distribution of $f(\theta_d)$.
- Algorithm
    1. calculate in parallel
    2. combine
- Examples
- Want to make that easy
    - Store output
    - Parallel
    - Reduce


# Examples

```{r}
library(rvec)
library(dplyr, warn.conflicts = FALSE)
library(tidyr)
library(ggplot2)
```



## Toy example





## Divorces

```{r}
divorce
```

```{r}
divorce_rv <- divorce %>%
  collapse_to_rvec(draw = "sim", value = rate)
divorce_rv
```


```{r}
divorce_rv %>%
  group_by(time, sex) %>%
  summarise(tdr = 5 * sum(rate))
```


```{r}
divorce_rv %>%
  group_by(time, sex) %>%
  summarise(tdr = 5 * sum(rate)) %>%
  mutate(draws_quantile(tdr))
```

```{r}
divorce_rv %>%
  pivot_wider(names_from = sex, values_from = rate) %>%
  mutate(ratio = Female / Male)
```


```{r, fig.width = 5, fig.height = 5}
divorce_rv %>%
  pivot_wider(names_from = sex, values_from = rate) %>%
  mutate(ratio = Female / Male) %>%
  mutate(draws_quantile(ratio)) %>%
  ggplot(aes(x = age, 
             ymin = `ratio_2.5%`, 
             y = `ratio_50%`,
             ymax = `ratio_97.5%`)) +
  facet_wrap(vars(time), ncol = 1) +
  geom_pointrange(fatten = 1)
```



# Main functions

## creation

## manipulation

## summarising
   
    
# Design

## vctrs

- departures from vctrs

## matrixStats

- timings

# Other packages

## coda, posterior

## ggdist

?other









