<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rvec">
<title>Package rvecs • rvec</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Package rvecs">
<meta property="og:description" content="rvec">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rvec</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vig1_overview.html">Package rvecs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Package rvecs</h1>
                        <h4 data-toc-skip class="author">John Bryant</h4>
                        
      
      
      <div class="d-none name"><code>vig1_overview.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="sec:aims">
<span class="header-section-number">1</span> Aims of <strong>rvecs</strong><a class="anchor" aria-label="anchor" href="#sec:aims"></a>
</h2>
<p>Many modern statistical methods, particularly Bayesian methods, produce random draws from a distribution. A exceptionally useful feature of these draws is that they can be used to make inferences about derived quantities. The procedure is:</p>
<ul>
<li>Step 1. Calculate the derived quantity for each of the random draws.</li>
<li>Step 2. Summaries the distribution of these derived quantities.</li>
</ul>
<p>If, for instance, we have randoms draws of age-specific mortality rates, and we want make inferences about life expectancy (a summary indicator for mortality rates), then we proceed as follows:</p>
<ul>
<li>Step 1. Derive life expectancy for each set of age-specific mortality rates.</li>
<li>Step 2. Calculate means, medians, or other statistics for these life expectancies.</li>
</ul>
<p>For more on the theory behind manipulating random draws, and for an argument that R needs high-level tools to help with this manipulation, see <span class="citation">Kerman and Gelman (2007)</span>.</p>
<p>Package <strong>rvec</strong> provides tools for working with random draws. The draws are held in a structure called an rvec, which can, for many purposes, be treated like an ordinary R vector, and manipulated using ordinary base R and <a href="https://www.tidyverse.org" class="external-link">tidyverse</a> code. <strong>rvec</strong> also contains functions for summarizing across random draws.</p>
</div>
<div class="section level2" number="2">
<h2 id="examples">
<span class="header-section-number">2</span> Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3" number="2.1">
<h3 id="toy-example">
<span class="header-section-number">2.1</span> Toy example<a class="anchor" aria-label="anchor" href="#toy-example"></a>
</h3>
<p>We begin with a toy example, to illustrate basic functionality.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/rvec/">rvec</a></span><span class="op">)</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span>
<span><span class="va">theta</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 3,1,0</span></span></code></pre></div>
<p>The header <code>&lt;rvec_dbl&lt;3&gt;[1]&gt;</code> indicates that rvec <code>theta</code> holds three random draws, each of which is a double, and that, regarded as a vector, <code>theta</code> has length 1.</p>
<p>We can perform standard mathematical operations:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 10,2,1</span></span></code></pre></div>
<p><code>theta</code> recycles to match the length of other vectors,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 4,2,1  2,0,-1</span></span></code></pre></div>
<p>including other rvecs,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta</span>          </span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] -0.2,0.4,0.1 -0.1,0.1,0.6</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">+</span> <span class="va">beta</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 2.8,1.4,0.1 2.9,1.1,0.6</span></span></code></pre></div>
<p>To summarize across random draws, we use <code>draws_*</code> functions, e.g.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/draws_median.html">draws_mean</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1 0.2</span></span></code></pre></div>
</div>
<div class="section level3" number="2.2">
<h3 id="sec:divorce">
<span class="header-section-number">2.2</span> Divorce rates<a class="anchor" aria-label="anchor" href="#sec:divorce"></a>
</h3>
<p>Our next example is more involved, and includes the use of some standard tidyverse packages.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>We analyse a posterior sample from a Bayesian model of divorce rates in New Zealand. The rates are divorces per thousand people per year, disaggregated by age and sex.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22,000 × 4</span></span></span>
<span><span class="co">#&gt;    age   sex     draw   rate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 15-19 Female     1 0.046<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 15-19 Female     2 0.036<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 15-19 Female     3 0.044<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 15-19 Female     4 0.041<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 15-19 Female     5 0.033<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 15-19 Female     6 0.051<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 15-19 Female     7 0.024<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 15-19 Female     8 0.028<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 15-19 Female     9 0.033<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 15-19 Female    10 0.042<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21,990 more rows</span></span></span></code></pre></div>
<p>First we convert the data from a ‘data base’ format, where each row describes a single draw, to an rvec format, where multiple draws are folded into an rvec.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce_rv</span> <span class="op">&lt;-</span> <span class="va">divorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collapse_to_rvec.html">collapse_to_rvec</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">rate</span><span class="op">)</span></span>
<span><span class="va">divorce_rv</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 3</span></span></span>
<span><span class="co">#&gt;    age   sex                    rate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 15-19 Female 0.036 (0.019, 0.068)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 20-24 Female    0.67 (0.58, 0.78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 25-29 Female         3.2 (3, 3.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 30-34 Female       5.8 (5.5, 6.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 35-39 Female       6.5 (6.2, 6.9)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 40-44 Female       7.1 (6.8, 7.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 45-49 Female       7.2 (6.9, 7.6)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 50-54 Female         6 (5.8, 6.3)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 55-59 Female       4.4 (4.2, 4.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 60-64 Female         2.7 (2.5, 3)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span></code></pre></div>
<p>When the number of draws is large, the print method displays <code>&lt;median&gt; (&lt;2.5% quantile&gt;, &lt;97.5% quantile&gt;)</code> for the distribution, rather than the individual draws.</p>
<p>We define the ‘total divorce rate’ to be the number of divorces that a person would expect to experience over their lifetime under prevailing divorce rates. The total divorce rate can be calculated as</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce_rv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>TDR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   sex                  TDR</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female 0.22 (0.22, 0.23)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male   0.23 (0.22, 0.23)</span></span></code></pre></div>
<p>We summarize across draws using <code><a href="../reference/draws_ci.html">draws_ci()</a></code>, which, by default, calculates medians and 95% credible intervals. Function <code><a href="../reference/draws_ci.html">draws_ci()</a></code> returns a tibble rather than a vector, so, following standard <code>mutate</code> rules, we do not explicitly create new columns.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce_rv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>tdr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/draws_ci.html">draws_ci</a></span><span class="op">(</span><span class="va">tdr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   sex                  tdr tdr.lower tdr.mid tdr.upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female 0.22 (0.22, 0.23)     0.218   0.223     0.228</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male   0.23 (0.22, 0.23)     0.221   0.226     0.231</span></span></code></pre></div>
<p>Next we calculate the ratio between female and male divorce rates,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce_ratio</span> <span class="op">&lt;-</span> <span class="va">divorce_rv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sex</span>, values_from <span class="op">=</span> <span class="va">rate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="va">Female</span> <span class="op">/</span> <span class="va">Male</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/draws_ci.html">draws_ci</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and graph the result</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">divorce_ratio</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, </span>
<span>           ymin <span class="op">=</span> <span class="va">ratio.lower</span>, </span>
<span>           y <span class="op">=</span> <span class="va">ratio.mid</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">ratio.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig1_overview_files/figure-html/unnamed-chunk-14-1.png"><!-- --></p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="sec:structure">
<span class="header-section-number">3</span> Structure of rvecs<a class="anchor" aria-label="anchor" href="#sec:structure"></a>
</h2>
<p>The class <code>"rvec"</code> has four subclasses:</p>
<ul>
<li>
<code>"rvec_dbl"</code>, which holds doubles, e.g. <code>3.142</code>, <code>-1.01</code>.</li>
<li>
<code>"rvec_int"</code>, which holds integers, e.g. <code>42</code>, <code>-1</code>.</li>
<li>
<code>"rvec_lgl"</code>, which holds <code>TRUE</code>, <code>FALSE</code>, and <code>NA</code>.</li>
<li>
<code>"rvec_chr"</code>, which hold characters, e.g. <code>"a"</code>, <code>"Thomas Bayes"</code>.</li>
</ul>
<p>Internally, an rvec is a matrix, with each row representing one unknown quantity, and each column representing one draw from the joint distribution of the unknown quantities,</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="20%">
<col width="21%">
<col width="21%">
<col width="14%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th></th>
<th align="center">Draw 1</th>
<th align="center">Draw 2</th>
<th align="center"><span class="math inline">\(\dots\)</span></th>
<th align="center">Draw <span class="math inline">\(n\)</span>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Quantity 1</td>
<td align="center"><span class="math inline">\(\theta_{11}\)</span></td>
<td align="center"><span class="math inline">\(\theta_{12}\)</span></td>
<td align="center"><span class="math inline">\(\dots\)</span></td>
<td align="center"><span class="math inline">\(\theta_{1n}\)</span></td>
</tr>
<tr class="even">
<td>Quantity 2</td>
<td align="center"><span class="math inline">\(\theta_{21}\)</span></td>
<td align="center"><span class="math inline">\(\theta_{22}\)</span></td>
<td align="center"><span class="math inline">\(\dots\)</span></td>
<td align="center"><span class="math inline">\(\theta_{2n}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\ddots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td>Quantity <span class="math inline">\(m\)</span>
</td>
<td align="center"><span class="math inline">\(\theta_{m1}\)</span></td>
<td align="center"><span class="math inline">\(\theta_{m2}\)</span></td>
<td align="center"><span class="math inline">\(\dots\)</span></td>
<td align="center"><span class="math inline">\(\theta_{mn}\)</span></td>
</tr>
</tbody>
</table>
<p>Ordinary functions are applied independently to each column. For instance, calling <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> on an rvec creates a new rvec with structure</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="13%">
<col width="25%">
<col width="25%">
<col width="9%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th></th>
<th align="center">Draw 1</th>
<th align="center">Draw 2</th>
<th align="center"><span class="math inline">\(\dots\)</span></th>
<th align="center">Draw <span class="math inline">\(n\)</span>
</th>
</tr></thead>
<tbody><tr class="odd">
<td>Quantity 1</td>
<td align="center"><span class="math inline">\(\sum_{i=1}^m\theta_{i1}\)</span></td>
<td align="center"><span class="math inline">\(\sum_{i=1}^m\theta_{i2}\)</span></td>
<td align="center"><span class="math inline">\(\dots\)</span></td>
<td align="center"><span class="math inline">\(\sum_{i=1}^m\theta_{in}\)</span></td>
</tr></tbody>
</table>
<p>Functions with a <code>draws_</code> prefix are applied independently to each row. For instance, calling <code><a href="../reference/draws_median.html">draws_mean()</a></code> on an rvec creates a new numeric vector with structure</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="center">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Quantity 1</td>
<td align="center"><span class="math inline">\(\frac{1}{n}\sum_{j=1}^n\theta_{1j}\)</span></td>
</tr>
<tr class="even">
<td>Quantity 2</td>
<td align="center"><span class="math inline">\(\frac{1}{n}\sum_{j=1}^n\theta_{2j}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td>Quantity <span class="math inline">\(m\)</span>
</td>
<td align="center"><span class="math inline">\(\frac{1}{n}\sum_{j=1}^n\theta_{mj}\)</span></td>
</tr>
</tbody>
</table>
<p>Each rvec holds a fixed number of draws. Two rvecs can only be used together in a function if</p>
<ol style="list-style-type: decimal">
<li>both rvecs have the same number of draws, or</li>
<li>one or more rvecs have a single draw.</li>
</ol>
</div>
<div class="section level2" number="4">
<h2 id="creating-rvecs">
<span class="header-section-number">4</span> Creating rvecs<a class="anchor" aria-label="anchor" href="#creating-rvecs"></a>
</h2>
<p>An individual rvec can be created from a list of vectors,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">LETTERS</span>, <span class="va">letters</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_chr&lt;26&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] ..A.. ..a..</span></span></code></pre></div>
<p>a matrix,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;1000&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] -0.042 (-2, 1.9) -0.024 (-2, 2.1)</span></span></code></pre></div>
<p>or an atomic vector</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_lgl&lt;1&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] T F</span></span></code></pre></div>
<p>Function <code><a href="../reference/rvec.html">rvec()</a></code> chooses from classes <code>"rvec_dbl"</code>, <code>"rvec_int"</code>, <code>"rvec_lgl"</code>, and <code>"rvec_chr"</code>, based on the input. To enforce a particular class, use function <code><a href="../reference/rvec.html">rvec_dbl()</a></code>, <code><a href="../reference/rvec.html">rvec_int()</a></code>, <code><a href="../reference/rvec.html">rvec_lgl()</a></code>, or <code><a href="../reference/rvec.html">rvec_chr()</a></code>,</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;3&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2,3</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec_dbl</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;3&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2,3</span></span>
<span><span class="fu"><a href="../reference/rvec.html">rvec_chr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_chr&lt;3&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "1","2","3"</span></span></code></pre></div>
<p>When the raw data take the form of a database with one draw per row, the most efficient way to create rvecs is to use <code><a href="../reference/collapse_to_rvec.html">collapse_to_rvec()</a></code>. See Section <a href="#sec:divorce">2.2</a> for an example.</p>
<p>Section <a href="#sec:prob">6</a> shows how to create an rvec consisting of draws from a standard probability distribution.</p>
</div>
<div class="section level2" number="5">
<h2 id="mathematical-and-logical-operations">
<span class="header-section-number">5</span> Mathematical and logical operations<a class="anchor" aria-label="anchor" href="#mathematical-and-logical-operations"></a>
</h2>
<p>Mathematical and logical operations are applied independently to each draw.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_lgl&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] T,F</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_lgl&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] T,T</span></span></code></pre></div>
<p>User-defined functions that consist entirely of standard mathematical and logical operations should just work.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu">logit</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;           x              y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;2&gt;&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;2&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   0.2,0.4 -1.386,-0.4055</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   0.6,0.9   0.4055,2.197</span></span></code></pre></div>
<p>Multiplying an rvec by a matrix produces an rvec,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>               <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 4,6 3,4</span></span></code></pre></div>
<p><strong>rvec</strong> contains a suite of functions for summarising weighted data:</p>
<ul>
<li><code><a href="../reference/weighted_mean.html">weighted_mad()</a></code></li>
<li><code><a href="../reference/weighted_mean.html">weighted_mean()</a></code></li>
<li><code><a href="../reference/weighted_mean.html">weighted_median()</a></code></li>
<li><code><a href="../reference/weighted_mean.html">weighted_sd()</a></code></li>
<li><code><a href="../reference/weighted_mean.html">weighted_var()</a></code></li>
</ul>
<p>All of these are built on functions from package <a href="https://CRAN.R-project.org/package=matrixStats" class="external-link">matrixStats</a>.</p>
</div>
<div class="section level2" number="6">
<h2 id="sec:prob">
<span class="header-section-number">6</span> Probability distributions<a class="anchor" aria-label="anchor" href="#sec:prob"></a>
</h2>
<p>Standard R probability functions such as <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code> or <code><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom()</a></code> do not allow rvec arguments. Package <strong>rvec</strong> provides modified functions that do. For instance,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dnorm_rvec.html">dnorm_rvec</a></span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 0.1258,0.1283 0.08066,0.018</span></span>
<span><span class="fu"><a href="../reference/dbinom_rvec.html">rbinom_rvec</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">y</span><span class="op">+</span><span class="fl">10</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 7,6  10,2</span></span></code></pre></div>
<p>The return value from an <strong>rvec</strong> probability function is an rvec if and only if at least one argument to the function is an rvec – with one exception. The exception is random variate functions where a value is suppplied for a special argument called <code>n_draw</code>. When a value for <code>n_draw</code> is supplied, the return value is an rvec with <code>n_draw</code> draws,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dnorm_rvec.html">rnorm_rvec</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, mean <span class="op">=</span> <span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">10</span>, n_draw <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] 105.2,113.9 88.88,108.2 100.3,97.04</span></span></code></pre></div>
<p>This is a convenient way to create inputs to a simulation.</p>
</div>
<div class="section level2" number="7">
<h2 id="manipulating-rvecs">
<span class="header-section-number">7</span> Manipulating rvecs<a class="anchor" aria-label="anchor" href="#manipulating-rvecs"></a>
</h2>
<div class="section level3" number="7.1">
<h3 id="subsetting">
<span class="header-section-number">7.1</span> Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h3>
<p>Standard R ways of selecting elements from vectors work with rvecs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>               b <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>               c <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt;   a </span></span>
<span><span class="co">#&gt; 1,2</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt;   a   c </span></span>
<span><span class="co">#&gt; 1,2 5,6</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt;   a   c </span></span>
<span><span class="co">#&gt; 1,2 5,6</span></span></code></pre></div>
<p>The third case above is an example the common R idiom <code>x[y]</code>, where a logical vector <code>y</code> is used to pick out elements of the vector <code>x</code>. The idiom also works when <code>y</code> is a logical rvec,</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>               <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>               <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2 3,4 5,6</span></span>
<span><span class="va">y</span></span>
<span><span class="co">#&gt; &lt;rvec_lgl&lt;2&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] T,T T,F F,F</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">y</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">]</span> <span class="co">## create 'y' on the fly</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2</span></span></code></pre></div>
<p>To implement the idiom, a convention is needed to deal with varying values within the same element of <code>y</code>. For instance, in the sample above, we need a way of handling the second element of <code>y</code>, which consists of one <code>TRUE</code> and one <code>FALSE</code>. The convention used by <strong>rvec</strong> is that <code>y</code> picks out an element of <code>x</code> if <em>all</em> draws of <code>y</code> for that element are <code>TRUE</code>.</p>
<p>Looking across multiple draws of <code>y</code> is unavoidable when implementing <code>x[y]</code>. However, it is typically not the behavior we want when working with multiple draws. Instead, we usually want to process each draw independently. This can be done using function <code><a href="../reference/if_else_rvec.html">if_else_rvec()</a></code>, introduced in Section <a href="#sec:ifelse">7.2</a>.</p>
</div>
<div class="section level3" number="7.2">
<h3 id="sec:ifelse">
<span class="header-section-number">7.2</span> If-Else<a class="anchor" aria-label="anchor" href="#sec:ifelse"></a>
</h3>
<p>The standard R function <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code> does not work with rvecs. The tidyverse equivalent works when the <code>true</code>, <code>false</code>, and <code>missing</code> arguments are rvecs,</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>               <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>        true <span class="op">=</span> <span class="va">x</span>,</span>
<span>        false <span class="op">=</span> <span class="op">-</span><span class="va">x</span><span class="op">)</span>        </span>
<span><span class="co">#&gt; &lt;rvec_int&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2   -3,-4</span></span></code></pre></div>
<p>It does not, however, work when the <code>condition</code> argument is an rvec. For that case we need the <strong>rvec</strong> function <code><a href="../reference/if_else_rvec.html">if_else_rvec()</a></code>,</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/if_else_rvec.html">if_else_rvec</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">2</span>, <span class="va">x</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,2 2,2</span></span></code></pre></div>
<p>Function <code><a href="../reference/if_else_rvec.html">if_else_rvec()</a></code> can be used to independently transform or recode values across different draws,</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3.3</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,3.3 NA,-2</span></span>
<span><span class="va">x_recode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/if_else_rvec.html">if_else_rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">99</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">x_recode</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,3.3 99,-2</span></span></code></pre></div>
</div>
<div class="section level3" number="7.3">
<h3 id="combining">
<span class="header-section-number">7.3</span> Combining<a class="anchor" aria-label="anchor" href="#combining"></a>
</h3>
<p>The standard R concatenation function, <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, works with rvecs,</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[4]&gt;</span></span>
<span><span class="co">#&gt; [1] 0.1,0.2 0.3,0.4 0.5,0.6 0.7,0.8</span></span></code></pre></div>
<p>Unfortunately, <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code> and <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code> cannot be made to work properly on raw rvecs,</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    data     </span></span>
<span><span class="co">#&gt; x1 numeric,4</span></span>
<span><span class="co">#&gt; x2 numeric,4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      x1        x2       </span></span>
<span><span class="co">#&gt; data numeric,4 numeric,4</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code> (but not <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>) works if the rvecs are contained in data frames</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x1      x2</span></span>
<span><span class="co">#&gt; 1 0.1,0.2 0.5,0.6</span></span>
<span><span class="co">#&gt; 2 0.3,0.4 0.7,0.8</span></span></code></pre></div>
<p>Tidyverse equivalents such as <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows()</a></code>, <code>dbplyr::bind_cols()</code>, <code><a href="https://vctrs.r-lib.org/reference/vec_bind.html" class="external-link">vctrs::vec_cbind()</a></code>, and <code><a href="https://vctrs.r-lib.org/reference/vec_bind.html" class="external-link">vctrs::vec_rbind()</a></code> <em>do</em> work with rvecs,</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vctrs.r-lib.org/" class="external-link">vctrs</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_bind.html" class="external-link">vec_cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span>
<span><span class="co">#&gt;      ...1    ...2</span></span>
<span><span class="co">#&gt; 1 0.1,0.2 0.5,0.6</span></span>
<span><span class="co">#&gt; 2 0.3,0.4 0.7,0.8</span></span></code></pre></div>
<p>Base R function <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code> does not work with rvecs (unless <code>simplify</code> is set to <code>FALSE</code>). <strong>rvec</strong> therefore supplies a function called <code><a href="../reference/map_rvec.html">map_rvec()</a></code> (based on functions in package <a href="https://purrr.tidyverse.org" class="external-link">purrr</a>) that does the same job:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          b <span class="op">=</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">l</span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 9,16</span></span>
<span><span class="fu"><a href="../reference/map_rvec.html">map_rvec</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">sqrt</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;rvec_dbl&lt;2&gt;[2]&gt;</span></span>
<span><span class="co">#&gt;   a   b </span></span>
<span><span class="co">#&gt; 1,2 3,4</span></span></code></pre></div>
</div>
<div class="section level3" number="7.4">
<h3 id="coercing">
<span class="header-section-number">7.4</span> Coercing<a class="anchor" aria-label="anchor" href="#coercing"></a>
</h3>
<p>Function <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix()</a></code> returns the data underlying an rvec.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nr <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    1    3    5</span></span>
<span><span class="co">#&gt; [2,]    2    4    6</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvec.html">rvec</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;rvec_int&lt;3&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] 1,3,5 2,4,6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    1    3    5</span></span>
<span><span class="co">#&gt; [2,]    2    4    6</span></span></code></pre></div>
<p>Function <code><a href="../reference/as_list_col.html">as_list_col()</a></code> returns a list of vectors</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_list_col.html">as_list_col</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 3 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 4 6</span></span></code></pre></div>
<p>Functions such as <a href="https://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">point_interval</a> in package <a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a> accept lists of vector. A good way to access the sophisticated plotting facilities in <strong>ggdist</strong>, or in packages such as <a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a> and <a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a> is to use <code><a href="../reference/as_list_col.html">as_list_col()</a></code> to convert an rvec to a list column.</p>
<p>Function <code><a href="../reference/collapse_to_rvec.html">expand_from_rvec()</a></code> is the inverse of function <code><a href="../reference/collapse_to_rvec.html">collapse_to_rvec()</a></code>, introduced in Section <a href="#sec:divorce">2.2</a>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   age   sex     draw   rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 15-19 Female     1 0.046<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15-19 Female     2 0.036<span style="text-decoration: underline;">9</span></span></span>
<span><span class="va">divorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collapse_to_rvec.html">collapse_to_rvec</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">rate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   age   sex                    rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 15-19 Female 0.036 (0.019, 0.068)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 20-24 Female    0.67 (0.58, 0.78)</span></span>
<span><span class="va">divorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collapse_to_rvec.html">collapse_to_rvec</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">rate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collapse_to_rvec.html">expand_from_rvec</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   age   sex     draw   rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 15-19 Female     1 0.046<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 15-19 Female     2 0.036<span style="text-decoration: underline;">9</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="8">
<h2 id="summarising-distributions">
<span class="header-section-number">8</span> Summarising distributions<a class="anchor" aria-label="anchor" href="#summarising-distributions"></a>
</h2>
<p>Most functions in <strong>rvec</strong> are concerned with deriving random vectors from other random vectors: that is, with the column-wise calculations described in Section <a href="#sec:structure">3</a>. But once we have derived the random vectors, we typically want to summarise them, using statistics such as means or quantiles: that is, we want to carry out row-wise calculations.</p>
<p>The functions for carrying out row-wise calculations on rvecs are:</p>
<ul>
<li>[draws_all()]</li>
<li>[draws_any()]</li>
<li>[draws_median()]</li>
<li>[draws_mean()]</li>
<li>[draws_mode()]</li>
<li>[draws_ci()]</li>
<li>[draws_quantile()]</li>
<li>[draws_fun()]</li>
</ul>
<p>Internally, most of these functions call functions from <a href="https://CRAN.R-project.org/package=matrixStats" class="external-link">matrixStats</a>, which makes them fast.</p>
<p>For most purposes, [draws_ci()], which calculates credible intervals, is the most useful of the draws functions,</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divorce_rv</span> <span class="op">&lt;-</span> <span class="va">divorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collapse_to_rvec.html">collapse_to_rvec</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">rate</span><span class="op">)</span></span>
<span><span class="va">divorce_rv</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 3</span></span></span>
<span><span class="co">#&gt;    age   sex                    rate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 15-19 Female 0.036 (0.019, 0.068)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 20-24 Female    0.67 (0.58, 0.78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 25-29 Female         3.2 (3, 3.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 30-34 Female       5.8 (5.5, 6.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 35-39 Female       6.5 (6.2, 6.9)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 40-44 Female       7.1 (6.8, 7.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 45-49 Female       7.2 (6.9, 7.6)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 50-54 Female         6 (5.8, 6.3)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 55-59 Female       4.4 (4.2, 4.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 60-64 Female         2.7 (2.5, 3)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="va">divorce_rv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/draws_ci.html">draws_ci</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 6</span></span></span>
<span><span class="co">#&gt;    age   sex                    rate rate.lower rate.mid rate.upper</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 15-19 Female 0.036 (0.019, 0.068)     0.019<span style="text-decoration: underline;">3</span>   0.036<span style="text-decoration: underline;">0</span>     0.067<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 20-24 Female    0.67 (0.58, 0.78)     0.579    0.673      0.782 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 25-29 Female         3.2 (3, 3.4)     3.02     3.22       3.45  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 30-34 Female       5.8 (5.5, 6.1)     5.54     5.80       6.06  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 35-39 Female       6.5 (6.2, 6.9)     6.21     6.54       6.86  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 40-44 Female       7.1 (6.8, 7.4)     6.85     7.13       7.42  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 45-49 Female       7.2 (6.9, 7.6)     6.87     7.22       7.57  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 50-54 Female         6 (5.8, 6.3)     5.77     6.03       6.33  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 55-59 Female       4.4 (4.2, 4.7)     4.17     4.40       4.66  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 60-64 Female         2.7 (2.5, 3)     2.48     2.72       2.99  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2" number="9">
<h2 id="other-packages">
<span class="header-section-number">9</span> Other packages<a class="anchor" aria-label="anchor" href="#other-packages"></a>
</h2>
<p>The first R package to provide a specialized object for handling multiple draws was <a href="https://CRAN.R-project.org/package=rv" class="external-link">rv</a>. The object, called an rv, can be manipulated and summarized much like an rvec. However, in software terms, an rv is not strictly a vector (calling <code><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector()</a></code> on one returns <code>FALSE</code>) and an rv does not always behave as expected inside a data frame. It is therefore not well suited to tidyverse-style work flows.</p>
<p>R package <a href="https://CRAN.R-project.org/package=posterior" class="external-link">posterior</a> provides several data structures for handling multiple draws, including one, called a rvar, that is similar to an rvec. An rvar is, however, is not limited to a single dimension, and has special facilities for dealing with multiple chains (as produced by Markov chain Monte Carlo methods.) These features are essential for some analyses, but they can make rvars harder to master, and they are not needed for most tidyverse-style work flows.</p>
<p>Whereas rvecs interpret summary functions such as <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> and <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> as operations to be applied independently on each draw, rvars interpret them as operations to be applied across draws. The result is that code written for ordinary R vectors will often work on rvecs, but need modification to work on rvars. The tidyverse function <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count()</a></code>, for instance, works with rvecs but not rvars.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-kerman2007manipulating" class="csl-entry">
Kerman, Jouni, and Andrew Gelman. 2007. <span>“Manipulating and Summarizing Posterior Simulations Using Random Variable Objects.”</span> <em>Statistics and Computing</em> 17: 235–44.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John Bryant.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
